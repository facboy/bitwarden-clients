<td bitCell [ngClass]="RowHeightClass" class="tw-truncate tw-flex tw-items-center tw-gap-2">
  <app-vault-icon [cipher]="cipher()"></app-vault-icon>
  <div class="tw-flex tw-flex-col tw-w-full">
    <button
      bitLink
      class="tw-overflow-hidden tw-text-ellipsis tw-text-start tw-leading-snug"
      [disabled]="disabled()"
      (click)="viewCipher()"
      title="{{ 'editItemWithName' | i18n: cipher().name }}"
      type="button"
      appStopProp
      aria-haspopup="true"
    >
      {{ cipher().name }}
    </button>
    @if (hasAttachments()) {
      <i
        class="bwi bwi-paperclip tw-ml-2 tw-leading-normal"
        appStopProp
        title="{{ 'attachments' | i18n }}"
        aria-hidden="true"
      ></i>
      <span class="tw-sr-only">{{ "attachments" | i18n }}</span>
      @if (showFixOldAttachments()) {
        <i
          class="bwi bwi-exclamation-triangle tw-ml-2 tw-leading-normal tw-text-warning"
          appStopProp
          title="{{ 'attachmentsNeedFix' | i18n }}"
          aria-hidden="true"
        ></i>
        <span class="tw-sr-only">{{ "attachmentsNeedFix" | i18n }}</span>
      }
    }
    <span class="tw-text-sm tw-text-muted" appStopProp>{{ subtitle() }}</span>
  </div>
</td>
@if (showOwner()) {
  <td bitCell [ngClass]="RowHeightClass" class="tw-hidden @md:tw-table-cell">
    <app-org-badge
      [disabled]="disabled()"
      [organizationId]="cipher().organizationId"
      [organizationName]="cipher().organizationId | orgNameFromId: organizations()"
      appStopProp
    >
    </app-org-badge>
  </td>
}
<td bitCell [ngClass]="RowHeightClass" class="tw-text-right tw-whitespace-nowrap">
  @if (decryptionFailure()) {
    <button
      [disabled]="disabled() || !canManageCollection()"
      [bitMenuTriggerFor]="corruptedCipherOptions"
      size="small"
      bitIconButton="bwi-ellipsis-v"
      type="button"
      label="{{ 'options' | i18n }}"
      appStopProp
    ></button>
    <bit-menu #corruptedCipherOptions>
      @if (canDeleteCipher()) {
        <button bitMenuItem (click)="deleteCipher()" type="button">
          <span class="tw-text-danger">
            <i class="bwi bwi-fw bwi-trash" aria-hidden="true"></i>
            {{ (isDeleted() ? "permanentlyDelete" : "delete") | i18n }}
          </span>
        </button>
      }
    </bit-menu>
  } @else {
    @if (canLaunch()) {
      <button
        [disabled]="disabled()"
        bitIconButton="bwi-external-link"
        type="button"
        appStopProp
        label="{{ 'launch' | i18n }}"
        (click)="handleLaunch()"
      ></button>
    }
    @if (showCopyButton()) {
      <button
        [bitMenuTriggerFor]="copyOptions"
        [disabled]="disabled()"
        bitIconButton="bwi-clone"
        type="button"
        appStopProp
        label="{{ 'copyValue' | i18n }}"
      ></button>
      <bit-menu #copyOptions>
        @for (copyField of copyFields(); track copyField.field) {
          <button type="button" bitMenuItem [appCopyField]="copyField.field" [cipher]="cipher()">
            <i class="bwi bwi-fw bwi-clone" aria-hidden="true"></i>
            {{ copyField.title | i18n }}
          </button>
        }
      </bit-menu>
    }

    <button
      [bitMenuTriggerFor]="cipherOptions"
      [disabled]="disabled()"
      bitIconButton="bwi-ellipsis-v"
      type="button"
      appStopProp
      label="{{ 'options' | i18n }}"
    ></button>
    <bit-menu #cipherOptions>
      @if (canLaunch()) {
        <button type="button" bitMenuItem (click)="handleLaunch()">
          <i class="bwi bwi-fw bwi-external-link" aria-hidden="true"></i>
          {{ "launch" | i18n }}
        </button>
      }
      @for (copyField of copyFields(); track copyField.field) {
        <button type="button" bitMenuItem [appCopyField]="copyField.field" [cipher]="cipher()">
          <i class="bwi bwi-fw bwi-clone" aria-hidden="true"></i>
          {{ copyField.title | i18n }}
        </button>
      }
      @if (showMenuDivider()) {
        <bit-menu-divider />
      }
      @if (showFavorite()) {
        <button bitMenuItem type="button" (click)="toggleFavorite()">
          <i class="bwi bwi-fw bwi-star" aria-hidden="true"></i>
          {{ (cipher().favorite ? "unfavorite" : "favorite") | i18n }}
        </button>
      }
      @if (canEditCipher()) {
        <button bitMenuItem type="button" (click)="editCipher()">
          <i class="bwi bwi-fw bwi-pencil-square" aria-hidden="true"></i>
          {{ "edit" | i18n }}
        </button>
      }
      @if (showAttachments()) {
        <button bitMenuItem type="button" (click)="attachments()">
          <i class="bwi bwi-fw bwi-paperclip" aria-hidden="true"></i>
          {{ "attachments" | i18n }}
        </button>
      }
      @if (showClone()) {
        <button bitMenuItem type="button" (click)="clone()">
          <i class="bwi bwi-fw bwi-files" aria-hidden="true"></i>
          {{ "clone" | i18n }}
        </button>
      }
      @if (showAssignToCollections()) {
        <button bitMenuItem type="button" (click)="assignToCollections()">
          <i class="bwi bwi-fw bwi-collection-shared" aria-hidden="true"></i>
          {{ "assignToCollections" | i18n }}
        </button>
      }
      @if (showArchiveButton()) {
        @if (userCanArchive()) {
          <button bitMenuItem (click)="archive()" type="button">
            <i class="bwi bwi-fw bwi-archive" aria-hidden="true"></i>
            {{ "archiveVerb" | i18n }}
          </button>
        }
        @if (!userCanArchive()) {
          <button bitMenuItem (click)="badge.promptForPremium($event)" type="button">
            <i class="bwi bwi-fw bwi-archive" aria-hidden="true"></i>
            {{ "archiveVerb" | i18n }}
            <!-- Hide app-premium badge from accessibility tools as it results in a button within a button -->
            <div slot="end" class="-tw-mt-0.5" aria-hidden>
              <app-premium-badge #badge></app-premium-badge>
            </div>
          </button>
        }
      }

      @if (showUnArchiveButton()) {
        <button bitMenuItem (click)="unarchive()" type="button">
          <i class="bwi bwi-fw bwi-unarchive" aria-hidden="true"></i>
          {{ "unArchive" | i18n }}
        </button>
      }

      @if (isDeleted() && canRestoreCipher()) {
        <button bitMenuItem (click)="restore()" type="button">
          <i class="bwi bwi-fw bwi-undo" aria-hidden="true"></i>
          {{ "restore" | i18n }}
        </button>
      }
      @if (canDeleteCipher()) {
        <button bitMenuItem (click)="deleteCipher()" type="button">
          <span class="tw-text-danger">
            <i class="bwi bwi-fw bwi-trash" aria-hidden="true"></i>
            {{ (isDeleted() ? "permanentlyDelete" : "delete") | i18n }}
          </span>
        </button>
      }
    </bit-menu>
  }
</td>
